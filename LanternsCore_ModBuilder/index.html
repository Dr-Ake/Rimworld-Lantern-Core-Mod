<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Hero Gear Builder (LanternsCore)</title>
    <link rel="stylesheet" href="./assets/app.css" />
  </head>
  <body>
    <header class="header">
      <div class="header__title">
        <h1>Hero Gear Builder</h1>
        <p>Offline, no-install mod generator (exports a ZIP). Powered by LanternsCore.</p>
      </div>
      <div class="header__actions">
        <button id="btnImportZip" class="btn">Import ZIP</button>
        <button id="btnExport" class="btn btn--primary">Export ZIP</button>
        <button id="btnReset" class="btn btn--danger">Reset</button>
      </div>
    </header>

    <main class="main">
      <input id="fileImportZip" type="file" accept=".zip" style="display:none" />
      <nav class="tabs" aria-label="Builder tabs">
        <button class="tab tab--active" data-tab="mod">Mod</button>
        <button class="tab" data-tab="ring">Gear</button>
        <button class="tab" data-tab="costume">Costume</button>
        <button class="tab" data-tab="behavior">Behavior</button>
        <button class="tab" data-tab="import">Import Defs</button>
        <button class="tab" data-tab="charge">Charge</button>
        <button class="tab" data-tab="abilities">Abilities</button>
        <button class="tab" data-tab="selection">Selection</button>
        <button class="tab" data-tab="events">Events</button>
        <button class="tab" data-tab="export">Export</button>
      </nav>

      <section class="panel panel--active" data-panel="mod">
        <h2>Mod Info</h2>
        <p>Controls the add-on mod metadata. <code>PackageId</code> must be unique (use your name + mod name).</p>
        <div class="grid">
          <label class="field">
            <span>Mod name</span>
            <input id="modName" type="text" placeholder="My Hero Gear Mod" />
          </label>
          <label class="field">
            <span>Author</span>
            <input id="modAuthor" type="text" placeholder="YourName" />
          </label>
          <label class="field">
            <span>PackageId</span>
            <input id="packageId" type="text" placeholder="yourname.myherogear" />
            <small>Must be unique; letters/numbers/dots recommended.</small>
          </label>
          <label class="field field--wide">
            <span>Description</span>
            <textarea id="modDesc" rows="4" placeholder="Adds custom hero gear powered by a resource..."></textarea>
          </label>
          <label class="field field--wide">
            <span>Auto-add dependencies (recommended)</span>
            <label class="check">
              <input id="autoAddDependencies" type="checkbox" />
              <span>When you reference defs from other mods (via Import Defs), add those mods to the generated About.xml dependencies.</span>
            </label>
            <small class="muted">Works only for defs that were imported (the Builder cannot identify the source mod of a random typed defName).</small>
          </label>
          <label class="field field--wide">
            <span>Extra dependencies (optional, one packageId per line)</span>
            <textarea id="extraDependencies" rows="3" placeholder="some.author.modid&#10;another.modid"></textarea>
            <small class="muted">Use this if you typed defNames manually (no import) or if a mod's About.xml could not be detected.</small>
          </label>
        </div>
      </section>

      <section class="panel" data-panel="ring">
        <h2>Gear</h2>
        <p>Defines the actual wearable item (ring/belt/suit/mask). This is the ThingDef that grants charge + abilities.</p>
        <div class="grid">
          <label class="field">
            <span>Gear template (ParentName)</span>
            <select id="gearParent">
              <option value="Lantern_RingBase">Lantern_RingBase (ring)</option>
              <option value="Lantern_GearBeltBase">Lantern_GearBeltBase (belt)</option>
              <option value="Lantern_GearSuitBase">Lantern_GearSuitBase (suit)</option>
              <option value="Lantern_GearMaskBase">Lantern_GearMaskBase (mask)</option>
              <option value="Lantern_GearApparelBase">Lantern_GearApparelBase (generic apparel)</option>
              <option value="custom">Custom...</option>
            </select>
            <small>Controls the generated ThingDef ParentName (slot/layers/etc.).</small>
            <small id="gearParentDesc" class="muted"></small>
          </label>
          <label class="field">
            <span>Custom ParentName</span>
            <input id="gearParentCustom" type="text" placeholder="MyCustomApparelBase" />
            <small>Used only when Gear template is Custom.</small>
          </label>
          <label class="field">
            <span>Gear graphic style</span>
            <select id="gearGraphicClass">
              <option value="Graphic_Single">Graphic_Single (1 texture)</option>
              <option value="Graphic_Multi">Graphic_Multi (3 textures)</option>
            </select>
            <small id="gearGraphicDesc" class="muted"></small>
          </label>
          <label class="field">
            <span>Ring defName</span>
            <input id="ringDefName" type="text" placeholder="MyHeroGear_Ring" />
          </label>
          <label class="field">
            <span>Ring label</span>
            <input id="ringLabel" type="text" placeholder="my hero gear" />
          </label>
          <label class="field field--wide">
            <span>Ring description</span>
            <textarea id="ringDesc" rows="3" placeholder="A piece of gear fueled by ..."></textarea>
          </label>
          <label class="field">
            <span>Ring color (RGBA)</span>
            <input id="ringColor" type="text" placeholder="(1, 0, 0, 1)" />
          </label>
          <label class="field">
            <span>Resource label (charge bar text)</span>
            <input id="resourceLabel" type="text" placeholder="Willpower" />
          </label>
          <label class="field">
            <span>Item texPath (no extension)</span>
            <input id="ringTexPath" type="text" placeholder="MyHeroGear/Items/MyGear" />
            <small id="gearTexHint">Texture paths depend on the graphic style.</small>
          </label>
          <label class="field">
            <span>Market value</span>
            <input id="marketValue" type="number" min="0" step="1" />
          </label>
          <label class="field">
            <span>Mass</span>
            <input id="mass" type="number" min="0" step="0.01" />
          </label>
        </div>

        <div class="field field--wide">
          <h3>Apparel details (optional)</h3>
          <p class="muted">Overrides apparel settings on the gear ThingDef.</p>
          <div class="grid">
            <label class="field">
              <span>Tech level</span>
              <select id="techLevel">
                <option value="default">Default (inherit)</option>
                <option value="Neolithic">Neolithic</option>
                <option value="Medieval">Medieval</option>
                <option value="Industrial">Industrial</option>
                <option value="Spacer">Spacer</option>
                <option value="Ultratech">Ultratech</option>
                <option value="Archotech">Archotech</option>
              </select>
            </label>
            <label class="field">
              <span>Smeltable</span>
              <select id="smeltable">
                <option value="default">Default (inherit)</option>
                <option value="true">True</option>
                <option value="false">False</option>
              </select>
            </label>
            <label class="field">
              <span>Care if worn by corpse</span>
              <select id="careIfWornByCorpse">
                <option value="default">Default (inherit)</option>
                <option value="true">True</option>
                <option value="false">False</option>
              </select>
            </label>
            <label class="field">
              <span>Care if damaged</span>
              <select id="careIfDamaged">
                <option value="default">Default (inherit)</option>
                <option value="true">True</option>
                <option value="false">False</option>
              </select>
            </label>
            <label class="field">
              <span>Counts as clothing for nudity</span>
              <select id="countsAsClothingForNudity">
                <option value="default">Default (inherit)</option>
                <option value="true">True</option>
                <option value="false">False</option>
              </select>
            </label>
            <label class="field">
              <span>Flammability (0..1)</span>
              <input id="flammability" type="number" min="0" max="1" step="0.01" />
            </label>
            <label class="field">
              <span>Equip delay</span>
              <input id="equipDelay" type="number" min="0" step="0.1" />
            </label>
            <label class="field">
              <span>Deterioration rate</span>
              <input id="deteriorationRate" type="number" min="0" step="0.01" />
            </label>
          </div>

          <div class="field field--wide">
            <h4>Body part groups (optional)</h4>
            <div class="row row--actions">
              <label class="field">
                <span>BodyPartGroupDef</span>
                <input id="gearBodyPartGroupInput" type="text" placeholder="Hands" />
              </label>
              <button id="btnAddGearBodyPartGroup" class="btn btn--primary">Add</button>
              <div></div>
            </div>
            <div id="gearBodyPartGroupList" class="pillList"></div>
          </div>

          <div class="field field--wide">
            <h4>Apparel layers (optional)</h4>
            <div class="row row--actions">
              <label class="field">
                <span>Apparel layer</span>
                <input id="gearLayerInput" type="text" placeholder="Belt" />
              </label>
              <button id="btnAddGearLayer" class="btn btn--primary">Add</button>
              <div></div>
            </div>
            <div id="gearLayerList" class="pillList"></div>
          </div>

          <div class="field field--wide">
            <h4>Apparel tags (optional)</h4>
            <div class="row row--actions">
              <label class="field">
                <span>Tag</span>
                <input id="gearTagInput" type="text" placeholder="Artifact" />
              </label>
              <button id="btnAddGearTag" class="btn btn--primary">Add</button>
              <div></div>
            </div>
            <div id="gearTagList" class="pillList"></div>
          </div>
        </div>
      </section>

      <section class="panel" data-panel="costume">
        <h2>Costume / Outfit (optional)</h2>
        <p>
          This is the "superhero suit" feature: when the gear is worn, it can auto-equip apparel (mask/suit/etc.) and restore the original outfit when removed.
          You can either reference existing apparel defs (vanilla/modded) or generate new apparel defs here.
        </p>

        <div class="grid">
          <label class="field">
            <span>Enable costume transformation</span>
            <select id="enableCostume">
              <option value="no">No</option>
              <option value="yes">Yes</option>
            </select>
            <small id="enableCostumeDesc" class="muted"></small>
          </label>

          <label class="field">
            <span>Associated Hediff while worn (optional)</span>
            <input id="associatedHediff" type="text" placeholder="MyHediff" list="defs_HediffDef" />
          </label>

          <div class="field field--wide">
            <h3>Who gets a costume? (optional)</h3>
            <p>If a pawn fails these filters, the gear will still work but the transformation will not apply.</p>
            <div class="row">
              <label class="check">
                <input id="transformationAllowMaleGender" type="checkbox" />
                <span>Allow male</span>
              </label>
              <label class="check">
                <input id="transformationAllowFemaleGender" type="checkbox" />
                <span>Allow female</span>
              </label>
              <label class="check">
                <input id="transformationAllowNoneGender" type="checkbox" />
                <span>Allow gender none</span>
              </label>
            </div>
            <div class="row">
              <label class="check">
                <input id="transformationDisallowBodyTypeThin" type="checkbox" />
                <span>Disallow body type: Thin</span>
              </label>
              <label class="check">
                <input id="transformationDisallowBodyTypeFat" type="checkbox" />
                <span>Disallow body type: Fat</span>
              </label>
              <label class="check">
                <input id="transformationDisallowBodyTypeHulk" type="checkbox" />
                <span>Disallow body type: Hulk</span>
              </label>
            </div>
          </div>

          <div class="field field--wide">
            <h3>Transformation conditions (optional)</h3>
            <div class="row">
              <label class="check">
                <input id="transformationOnlyWhenDrafted" type="checkbox" />
                <span>Only transform while drafted</span>
              </label>
              <label class="check">
                <input id="transformationSkipConflictingApparel" type="checkbox" />
                <span>Skip pieces that would force stripping</span>
              </label>
            </div>
            <small>If enabled, the costume can auto-apply/revert when drafting/undrafting.</small>
          </div>

          <div class="field field--wide">
            <h3>Missing texture behavior (optional)</h3>
            <p>If the costume can't render for a pawn's body type, choose what to do.</p>
            <div class="grid">
              <label class="field">
                <span>If missing worn graphic</span>
                <select id="transformationMissingGraphicBehavior">
                  <option value="none">Do nothing (may look wrong)</option>
                  <option value="skip">Skip costume for that pawn</option>
                  <option value="override">Force a body type while transformed</option>
                </select>
                <small id="transformationMissingGraphicBehaviorDesc" class="muted"></small>
              </label>
              <label class="field">
                <span>Add a toggle gizmo</span>
                <select id="transformationToggleGizmo">
                  <option value="no">No</option>
                  <option value="yes">Yes</option>
                </select>
                <small id="transformationToggleGizmoDesc">Adds an in-game button to toggle the costume on/off without removing the gear.</small>
              </label>
              <label class="field">
                <span>Toggle default state</span>
                <select id="transformationToggleDefaultOn">
                  <option value="yes">On</option>
                  <option value="no">Off</option>
                </select>
                <small id="transformationToggleDefaultOnDesc">Default costume state when the item is first spawned/created.</small>
              </label>
            </div>
          </div>

          <div class="field field--wide">
            <h3>Body type override (optional)</h3>
            <p>
              If your costume textures only exist for one body type, you can temporarily force the wearer to that body type while transformed.
              When the gear is removed (or transformation reverts), the pawn's original body type is restored.
            </p>
            <div class="grid">
              <label class="field">
                <span>Override body type while transformed</span>
                <select id="transformationOverrideBodyType">
                  <option value="no">No</option>
                  <option value="yes">Yes</option>
                </select>
                <small id="transformationOverrideBodyTypeDesc" class="muted"></small>
              </label>
              <label class="field">
                <span>Only override if missing textures</span>
                <select id="transformationOverrideBodyTypeOnlyIfMissing">
                  <option value="yes">Yes (recommended)</option>
                  <option value="no">No (always force)</option>
                </select>
                <small id="transformationOverrideBodyTypeOnlyIfMissingDesc">If enabled, the pawn keeps their original body type unless the costume cannot render.</small>
              </label>
              <label class="field">
                <span>BodyTypeDef to use</span>
                <select id="transformationBodyTypeOverride">
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                  <option value="Thin">Thin</option>
                  <option value="Fat">Fat</option>
                  <option value="Hulk">Hulk</option>
                  <option value="custom">Custom...</option>
                </select>
                <small id="transformationBodyTypeOverrideDesc" class="muted"></small>
              </label>
              <label class="field">
                <span>Custom BodyTypeDef</span>
                <input id="transformationBodyTypeOverrideCustom" type="text" placeholder="MyCustomBodyType" />
                <small>Used only when BodyTypeDef is Custom.</small>
              </label>
            </div>
          </div>

          <div class="field field--wide">
            <h3>Battery manifest (optional)</h3>
            <div class="row">
              <label class="check">
                <input id="allowBatteryManifest" type="checkbox" />
                <span>Enable manifest battery gizmo</span>
              </label>
              <label class="field">
                <span>Battery ThingDef</span>
                <input id="batteryDef" type="text" placeholder="Battery" list="defs_ThingDef" />
              </label>
              <label class="field">
                <span>Manifest cost (0..1)</span>
                <input id="batteryManifestCost" type="number" min="0" max="1" step="0.01" />
              </label>
            </div>
          </div>

          <div class="field field--wide">
            <h3>Reactive projectile evasion (optional)</h3>
            <p class="muted">
              Cancels incoming projectiles by consuming charge and spawning a gas cloud (e.g. BlindSmoke). This is framework-level behavior (no add-on C#).
            </p>
            <div class="grid">
              <label class="field">
                <span>Enable reactive evasion</span>
                <select id="reactiveEvadeProjectiles">
                  <option value="false">False</option>
                  <option value="true">True</option>
                </select>
              </label>
              <label class="field">
                <span>Cost per evade (0..1)</span>
                <input id="reactiveEvadeProjectilesCost" type="number" min="0" max="1" step="0.01" />
              </label>
              <label class="field">
                <span>Cooldown ticks</span>
                <input id="reactiveEvadeProjectilesCooldownTicks" type="number" min="0" step="1" />
              </label>
              <label class="field">
                <span>Allow explosive projectiles</span>
                <select id="reactiveEvadeAllowExplosiveProjectiles">
                  <option value="false">False (recommended)</option>
                  <option value="true">True</option>
                </select>
              </label>

              <label class="field">
                <span>Toggle gizmo</span>
                <select id="reactiveEvadeToggleGizmo">
                  <option value="false">False</option>
                  <option value="true">True</option>
                </select>
              </label>
              <label class="field">
                <span>Default enabled</span>
                <select id="reactiveEvadeDefaultEnabled">
                  <option value="true">True</option>
                  <option value="false">False</option>
                </select>
              </label>

              <label class="field">
                <span>Gas type</span>
                <input id="reactiveEvadeGasType" type="text" placeholder="BlindSmoke" />
              </label>
              <label class="field">
                <span>Gas radius</span>
                <input id="reactiveEvadeGasRadius" type="number" min="0" step="0.1" />
              </label>
              <label class="field">
                <span>Gas amount</span>
                <input id="reactiveEvadeGasAmount" type="number" min="0" step="1" />
              </label>
            </div>
          </div>

          <div class="field field--wide">
            <h3>Stat buffs while worn (optional)</h3>
            <p class="muted">Generates a HediffDef with statOffsets and applies it via <code>hediffsWhileWorn</code>.</p>
            <div class="grid">
              <label class="field">
                <span>StatDef</span>
                <input id="statBuffStat" type="text" placeholder="MoveSpeed" list="defs_StatDef" />
              </label>
              <label class="field">
                <span>Offset</span>
                <input id="statBuffOffset" type="number" step="0.01" placeholder="0.20" />
              </label>
              <div class="field">
                <span>Action</span>
                <button id="btnAddStatBuff" class="btn btn--primary">Add stat buff</button>
              </div>
            </div>
            <div id="statBuffList" class="cardList"></div>
          </div>

          <div class="field field--wide">
            <h3>Use existing apparel defs</h3>
            <div class="row row--actions">
              <label class="field">
                <span>Add apparel defName</span>
                <input id="existingApparelInput" type="text" placeholder="Apparel_PowerArmor" list="defs_ApparelDef" />
              </label>
              <button id="btnAddExistingApparel" class="btn btn--primary">Add</button>
              <div></div>
            </div>
            <div id="existingApparelList" class="pillList"></div>
            <small>These will be listed in <code>transformationApparel</code>. If you reference defs from another mod, your mod will still require that mod.</small>
          </div>

          <div class="field field--wide">
            <h3>Generate new costume apparel defs (optional)</h3>
            <div class="grid">
              <label class="field">
                <span>Apparel defName</span>
                <input id="genApparelDefName" type="text" placeholder="MyHero_Suit" />
              </label>
              <label class="field">
                <span>Label</span>
                <input id="genApparelLabel" type="text" placeholder="hero suit" />
              </label>
              <label class="field">
                <span>TexPath (no extension)</span>
                <input id="genApparelTexPath" type="text" placeholder="MyHero/Apparel/Suit" />
              </label>
              <label class="field">
                <span>Layers (comma separated)</span>
                <input id="genApparelLayers" type="text" placeholder="Middle" />
              </label>
              <label class="field">
                <span>Body part groups (comma separated)</span>
                <input id="genApparelBodyParts" type="text" placeholder="Torso, Legs" />
              </label>
              <div class="field">
                <span>Action</span>
                <button id="btnAddGeneratedApparel" class="btn btn--primary">Add generated apparel</button>
                <small>Generated apparel is added to transformation automatically.</small>
              </div>
            </div>
            <div id="generatedApparelList" class="cardList"></div>
          </div>
        </div>
      </section>

      <section class="panel" data-panel="behavior">
        <h2>Behavior</h2>
        <p>Optional behavior systems for sentient or cursed gear: stealth mode, corruption, ambient and wearer influence, and autonomy.</p>

        <div class="grid">
          <div class="field field--wide">
            <h3>Stealth / Veil (optional)</h3>
            <p class="muted">Toggleable stealth mode that applies a Hediff, drains a separate energy pool, and can block targeting.</p>
            <div class="grid">
              <label class="field">
                <span>Enable stealth mode</span>
                <select id="enableStealth">
                  <option value="no">No</option>
                  <option value="yes">Yes</option>
                </select>
              </label>
              <label class="field">
                <span>Stealth HediffDef</span>
                <input id="stealthHediff" type="text" placeholder="MyGear_Stealth" list="defs_HediffDef" />
              </label>
              <label class="field">
                <span>Toggle gizmo</span>
                <select id="stealthToggleGizmo">
                  <option value="yes">Yes</option>
                  <option value="no">No (always on)</option>
                </select>
              </label>
              <label class="field">
                <span>Default on</span>
                <select id="stealthDefaultOn">
                  <option value="no">No</option>
                  <option value="yes">Yes</option>
                </select>
              </label>
              <label class="field">
                <span>Break stealth on attack</span>
                <select id="stealthBreakOnAttack">
                  <option value="false">False</option>
                  <option value="true">True</option>
                </select>
              </label>
              <label class="field">
                <span>Prevent targeting while stealth</span>
                <select id="stealthPreventTargeting">
                  <option value="true">True</option>
                  <option value="false">False</option>
                </select>
              </label>
              <label class="field">
                <span>Gizmo icon path (optional)</span>
                <input id="stealthGizmoIconPath" type="text" placeholder="MyGear/UI/Stealth" />
              </label>
              <label class="field">
                <span>Gizmo label key (optional)</span>
                <input id="stealthGizmoLabelKey" type="text" placeholder="Lantern_Command_ToggleStealth" />
              </label>
              <label class="field">
                <span>Gizmo desc key (optional)</span>
                <input id="stealthGizmoDescKey" type="text" placeholder="Lantern_Command_ToggleStealthDesc" />
              </label>
            </div>

            <div class="grid">
              <label class="field">
                <span>Show stealth energy bar</span>
                <select id="stealthShowEnergyGizmo">
                  <option value="false">False</option>
                  <option value="true">True</option>
                </select>
              </label>
              <label class="field">
                <span>Energy label</span>
                <input id="stealthEnergyLabel" type="text" placeholder="Stealth" />
              </label>
              <label class="field">
                <span>Energy bar color (RGBA)</span>
                <input id="stealthEnergyColor" type="text" placeholder="(0.2, 0.6, 0.8, 1)" />
              </label>
              <label class="field">
                <span>Max energy</span>
                <input id="stealthEnergyMax" type="number" min="0.01" step="0.01" />
              </label>
              <label class="field">
                <span>Start energy (0..1)</span>
                <input id="stealthEnergyStartPercent" type="number" min="0" max="1" step="0.01" />
              </label>
              <label class="field">
                <span>Drain per second (0..1)</span>
                <input id="stealthEnergyDrainPerSecond" type="number" min="0" step="0.01" />
              </label>
              <label class="field">
                <span>Regen per day (0..1)</span>
                <input id="stealthEnergyRegenPerDay" type="number" min="0" step="0.01" />
              </label>
            </div>

            <div class="field field--wide">
              <h4>See-through rules (optional)</h4>
              <div class="row row--actions">
                <label class="field">
                  <span>PawnKindDef that can see stealth</span>
                  <input id="stealthSeeThroughPawnKindInput" type="text" placeholder="MySeerKind" list="defs_PawnKindDef" />
                </label>
                <button id="btnAddStealthSeeThroughPawnKind" class="btn btn--primary">Add</button>
                <div></div>
              </div>
              <div id="stealthSeeThroughPawnKindsList" class="pillList"></div>
              <div class="row row--actions">
                <label class="field">
                  <span>HediffDef that can see stealth</span>
                  <input id="stealthSeeThroughHediffInput" type="text" placeholder="MySeerHediff" list="defs_HediffDef" />
                </label>
                <button id="btnAddStealthSeeThroughHediff" class="btn btn--primary">Add</button>
                <div></div>
              </div>
              <div id="stealthSeeThroughHediffsList" class="pillList"></div>
            </div>
          </div>

          <div class="field field--wide">
            <h3>Corruption / Influence (optional)</h3>
            <p class="muted">Applies a persistent Hediff that grows while worn. You can also trigger mental states from severity.</p>
            <div class="grid">
              <label class="field">
                <span>Corruption HediffDef</span>
                <input id="corruptionHediff" type="text" placeholder="MyGear_Corruption" list="defs_HediffDef" />
              </label>
              <label class="field">
                <span>Initial severity</span>
                <input id="corruptionInitialSeverity" type="number" min="0" max="1" step="0.01" />
              </label>
              <label class="field">
                <span>Gain per day (0..1)</span>
                <input id="corruptionGainPerDay" type="number" min="0" step="0.01" />
              </label>
              <label class="field">
                <span>Tick interval (seconds)</span>
                <input id="corruptionTickIntervalSeconds" type="number" min="1" step="1" />
              </label>
              <label class="field">
                <span>Stealth multiplier</span>
                <input id="corruptionStealthMultiplier" type="number" min="0" step="0.1" />
              </label>
              <label class="field">
                <span>Attention multiplier</span>
                <input id="attentionMultiplier" type="number" min="0" step="0.1" />
              </label>
            </div>

            <div class="field field--wide">
              <h4>Mental state triggers (optional)</h4>
              <div class="grid">
                <label class="field">
                  <span>MentalStateDef</span>
                  <input id="corruptionMentalStateDef" type="text" placeholder="Berserk" list="defs_MentalStateDef" />
                </label>
                <label class="field">
                  <span>Min severity</span>
                  <input id="corruptionMentalStateMinSeverity" type="number" min="0" max="1" step="0.01" />
                </label>
                <label class="field">
                  <span>Max severity</span>
                  <input id="corruptionMentalStateMaxSeverity" type="number" min="0" max="1" step="0.01" />
                </label>
                <label class="field">
                  <span>Chance per check</span>
                  <input id="corruptionMentalStateChance" type="number" min="0" max="1" step="0.01" />
                </label>
                <label class="field">
                  <span>Check interval (ticks)</span>
                  <input id="corruptionMentalStateInterval" type="number" min="1" step="1" />
                </label>
                <label class="field">
                  <span>Require not already in state</span>
                  <select id="corruptionMentalStateRequireNotAlready">
                    <option value="true">True</option>
                    <option value="false">False</option>
                  </select>
                </label>
                <div class="field">
                  <span>Action</span>
                  <button id="btnAddCorruptionMentalState" class="btn btn--primary">Add trigger</button>
                </div>
              </div>
              <div id="corruptionMentalStateList" class="cardList"></div>
            </div>
          </div>

          <div class="field field--wide">
            <h3>Ambient influence (optional)</h3>
            <p class="muted">Applies a Hediff to pawns near the gear while it is unworn (useful for cursed artifacts).</p>
            <div class="grid">
              <label class="field">
                <span>Enable ambient influence</span>
                <select id="ambientInfluenceEnabled">
                  <option value="no">No</option>
                  <option value="yes">Yes</option>
                </select>
              </label>
              <label class="field">
                <span>Influence HediffDef</span>
                <input id="ambientInfluenceHediff" type="text" placeholder="MyGear_Whispers" list="defs_HediffDef" />
              </label>
              <label class="field">
                <span>Only when unworn</span>
                <select id="ambientInfluenceOnlyWhenUnworn">
                  <option value="true">True</option>
                  <option value="false">False</option>
                </select>
              </label>
              <label class="field">
                <span>Only when buried</span>
                <select id="ambientInfluenceOnlyWhenBuried">
                  <option value="false">False</option>
                  <option value="true">True</option>
                </select>
              </label>
              <label class="field">
                <span>Skip wearers</span>
                <select id="ambientInfluenceSkipWearers">
                  <option value="true">True</option>
                  <option value="false">False</option>
                </select>
              </label>
              <label class="field">
                <span>Affects colonists only</span>
                <select id="ambientInfluenceAffectsColonistsOnly">
                  <option value="true">True</option>
                  <option value="false">False</option>
                </select>
              </label>
              <label class="field">
                <span>Affects humanlike only</span>
                <select id="ambientInfluenceAffectsHumanlikeOnly">
                  <option value="true">True</option>
                  <option value="false">False</option>
                </select>
              </label>
              <label class="field">
                <span>Radius (0 = map-wide)</span>
                <input id="ambientInfluenceRadius" type="number" min="0" step="0.1" />
              </label>
              <label class="field">
                <span>Interval (seconds)</span>
                <input id="ambientInfluenceIntervalSeconds" type="number" min="1" step="1" />
              </label>
              <label class="field">
                <span>Initial severity</span>
                <input id="ambientInfluenceInitialSeverity" type="number" min="0" max="1" step="0.01" />
              </label>
              <label class="field">
                <span>Severity per tick</span>
                <input id="ambientInfluenceSeverityPerTick" type="number" min="0" step="0.001" />
              </label>
              <label class="field">
                <span>Break threshold</span>
                <input id="ambientInfluenceBreakThreshold" type="number" min="0" max="1" step="0.01" />
              </label>
              <label class="field">
                <span>Break chance</span>
                <input id="ambientInfluenceBreakChance" type="number" min="0" max="1" step="0.01" />
              </label>
              <label class="field">
                <span>Break MentalStateDef (optional)</span>
                <input id="ambientInfluenceMentalState" type="text" placeholder="Berserk" list="defs_MentalStateDef" />
              </label>
            </div>
          </div>

          <div class="field field--wide">
            <h3>Wearer influence (optional)</h3>
            <p class="muted">Applies a Hediff to nearby pawns while the gear is worn (like an aura).</p>
            <div class="grid">
              <label class="field">
                <span>Enable wearer influence</span>
                <select id="wearerInfluenceEnabled">
                  <option value="no">No</option>
                  <option value="yes">Yes</option>
                </select>
              </label>
              <label class="field">
                <span>Influence HediffDef</span>
                <input id="wearerInfluenceHediff" type="text" placeholder="MyGear_Influence" list="defs_HediffDef" />
              </label>
              <label class="field">
                <span>Affects colonists only</span>
                <select id="wearerInfluenceAffectsColonistsOnly">
                  <option value="true">True</option>
                  <option value="false">False</option>
                </select>
              </label>
              <label class="field">
                <span>Affects humanlike only</span>
                <select id="wearerInfluenceAffectsHumanlikeOnly">
                  <option value="true">True</option>
                  <option value="false">False</option>
                </select>
              </label>
              <label class="field">
                <span>Skip wearer</span>
                <select id="wearerInfluenceSkipWearer">
                  <option value="true">True</option>
                  <option value="false">False</option>
                </select>
              </label>
              <label class="field">
                <span>Radius</span>
                <input id="wearerInfluenceRadius" type="number" min="0" step="0.1" />
              </label>
              <label class="field">
                <span>Interval (seconds)</span>
                <input id="wearerInfluenceIntervalSeconds" type="number" min="1" step="1" />
              </label>
              <label class="field">
                <span>Initial severity</span>
                <input id="wearerInfluenceInitialSeverity" type="number" min="0" max="1" step="0.01" />
              </label>
              <label class="field">
                <span>Severity per tick</span>
                <input id="wearerInfluenceSeverityPerTick" type="number" min="0" step="0.001" />
              </label>
              <label class="field">
                <span>Break threshold</span>
                <input id="wearerInfluenceBreakThreshold" type="number" min="0" max="1" step="0.01" />
              </label>
              <label class="field">
                <span>Break chance</span>
                <input id="wearerInfluenceBreakChance" type="number" min="0" max="1" step="0.01" />
              </label>
              <label class="field">
                <span>Break MentalStateDef (optional)</span>
                <input id="wearerInfluenceMentalState" type="text" placeholder="Berserk" list="defs_MentalStateDef" />
              </label>
            </div>

            <div class="field field--wide">
              <h4>Trait severity modifiers (optional)</h4>
              <div class="grid">
                <label class="field">
                  <span>TraitDef</span>
                  <input id="wearerInfluenceTraitDef" type="text" placeholder="Greedy" list="defs_TraitDef" />
                </label>
                <label class="field">
                  <span>Degree (0 = any)</span>
                  <input id="wearerInfluenceTraitDegree" type="number" step="1" />
                </label>
                <label class="field">
                  <span>Severity multiplier</span>
                  <input id="wearerInfluenceTraitSeverityMultiplier" type="number" step="0.1" />
                </label>
                <label class="field">
                  <span>Severity offset</span>
                  <input id="wearerInfluenceTraitSeverityOffset" type="number" step="0.01" />
                </label>
                <div class="field">
                  <span>Action</span>
                  <button id="btnAddWearerInfluenceTrait" class="btn btn--primary">Add trait modifier</button>
                </div>
              </div>
              <div id="wearerInfluenceTraitList" class="cardList"></div>
            </div>
          </div>

          <div class="field field--wide">
            <h3>Autonomy / Temptation (optional)</h3>
            <p class="muted">Biases pawn apparel AI so they are more likely to wear this gear.</p>
            <div class="grid">
              <label class="field">
                <span>Enable auto-equip bias</span>
                <select id="autoEquipEnabled">
                  <option value="no">No</option>
                  <option value="yes">Yes</option>
                </select>
              </label>
              <label class="field">
                <span>Chance multiplier (0..1)</span>
                <input id="autoEquipChance" type="number" min="0" max="1" step="0.01" />
              </label>
              <label class="field">
                <span>Base score bonus</span>
                <input id="autoEquipScoreBonus" type="number" step="1" />
              </label>
              <label class="field">
                <span>Allow drafted pawns</span>
                <label class="check">
                  <input id="autoEquipAllowDrafted" type="checkbox" />
                  <span>Yes</span>
                </label>
              </label>
            </div>

            <div class="field field--wide">
              <h4>Trait bonuses</h4>
              <div class="grid">
                <label class="field">
                  <span>TraitDef</span>
                  <input id="autoEquipTraitDef" type="text" placeholder="Greedy" list="defs_TraitDef" />
                </label>
                <label class="field">
                  <span>Degree (0 = any)</span>
                  <input id="autoEquipTraitDegree" type="number" step="1" />
                </label>
                <label class="field">
                  <span>Score offset</span>
                  <input id="autoEquipTraitScoreOffset" type="number" step="1" />
                </label>
                <div class="field">
                  <span>Action</span>
                  <button id="btnAddAutoEquipTrait" class="btn btn--primary">Add trait bonus</button>
                </div>
              </div>
              <div id="autoEquipTraitList" class="cardList"></div>
            </div>

            <div class="field field--wide">
              <h4>Hediff bonuses</h4>
              <div class="grid">
                <label class="field">
                  <span>HediffDef</span>
                  <input id="autoEquipHediffDef" type="text" placeholder="MyHediff" list="defs_HediffDef" />
                </label>
                <label class="field">
                  <span>Min severity</span>
                  <input id="autoEquipHediffMinSeverity" type="number" step="0.01" />
                </label>
                <label class="field">
                  <span>Max severity</span>
                  <input id="autoEquipHediffMaxSeverity" type="number" step="0.01" />
                </label>
                <label class="field">
                  <span>Score offset</span>
                  <input id="autoEquipHediffScoreOffset" type="number" step="1" />
                </label>
                <label class="field">
                  <span>Severity multiplier</span>
                  <input id="autoEquipHediffSeverityMultiplier" type="number" step="0.1" />
                </label>
                <div class="field">
                  <span>Action</span>
                  <button id="btnAddAutoEquipHediff" class="btn btn--primary">Add hediff bonus</button>
                </div>
              </div>
              <div id="autoEquipHediffList" class="cardList"></div>
            </div>
          </div>

          <div class="field field--wide">
            <h3>Persistence / Removal rules (optional)</h3>
            <div class="grid">
              <label class="field">
                <span>Refuse removal</span>
                <select id="refuseRemoval">
                  <option value="no">No</option>
                  <option value="yes">Yes</option>
                </select>
              </label>
              <label class="field">
                <span>Refuse HediffDef (optional)</span>
                <input id="refuseRemovalHediff" type="text" placeholder="MyGear_Corruption" list="defs_HediffDef" />
              </label>
              <label class="field">
                <span>Min severity</span>
                <input id="refuseRemovalMinSeverity" type="number" min="0" max="1" step="0.01" />
              </label>
              <label class="field">
                <span>Message key (optional)</span>
                <input id="refuseRemovalMessageKey" type="text" placeholder="Lantern_RefuseRemoval" />
              </label>
              <label class="field">
                <span>Force drop on wearer death</span>
                <label class="check">
                  <input id="forceDropOnWearerDeath" type="checkbox" />
                  <span>Yes</span>
                </label>
              </label>
              <label class="field">
                <span>Force drop on corpse destroy</span>
                <label class="check">
                  <input id="forceDropOnCorpseDestroy" type="checkbox" />
                  <span>Yes</span>
                </label>
              </label>
              <label class="field">
                <span>Force drop on grave eject</span>
                <label class="check">
                  <input id="forceDropOnGraveEject" type="checkbox" />
                  <span>Yes</span>
                </label>
              </label>
            </div>
          </div>
        </div>
      </section>

      <section class="panel" data-panel="import">
        <h2>Import Defs (optional)</h2>
        <p>
          This lets the builder offer real autocomplete choices (ThingDefs, PawnKinds, etc.) based on your installed RimWorld and mods.
          It runs offline and only reads XML.
        </p>

        <div class="grid">
          <div class="field field--wide">
            <div class="row row--actions">
              <button id="btnImportFolder" class="btn btn--primary">Import from folder...</button>
              <button id="btnClearImport" class="btn btn--danger">Clear imported defs</button>
            </div>
            <small>
              Tip: choose your RimWorld `Data` folder to import vanilla + DLC defs, or choose your `Mods` folder (or a single mod folder) to include modded defs.
            </small>
          </div>

          <div class="field field--wide">
            <h3>Status</h3>
            <pre id="importStatus" class="pre"></pre>
          </div>
        </div>
      </section>

      <section class="panel" data-panel="charge">
        <h2>Charge / Resource</h2>
        <p>
          Charge is the fuel your gear spends to cast abilities. Most values here are <strong>fractions per day</strong> of your Max charge.
          Example: Max charge <code>2</code> and Passive regen per day <code>0.05</code> means <code>+0.10</code> charge per day.
        </p>
        <details class="help">
          <summary>Quick examples</summary>
          <ul class="muted">
            <li><code>passiveDrainPerDay=0.10</code> means the bar loses 10% of Max charge per day.</li>
            <li>An ability <code>cost=0.05</code> spends 5% of Max charge per cast.</li>
            <li>If both regen and drain are set, they combine (regen - drain).</li>
          </ul>
        </details>
        <div class="grid">
          <label class="field">
            <span>Show charge gizmo (power bar)</span>
            <select id="showChargeGizmo">
              <option value="true">True</option>
              <option value="false">False</option>
            </select>
            <small>Disable for gear that shouldn't show a resource meter (e.g. Batman utility belt).</small>
          </label>
          <label class="field">
            <span>Max charge</span>
            <input
              id="maxCharge"
              type="number"
              min="0.01"
              step="0.01"
              title="Capacity of the charge bar. Costs/regen/drain use fractions of this value."
            />
            <small>Capacity. Ability costs are fractions of this.</small>
          </label>
          <label class="field">
            <span>Passive regen per day</span>
            <input
              id="passiveRegenPerDay"
              type="number"
              min="0"
              step="0.001"
              title="Adds charge over time. This is a fraction of Max charge per in-game day (e.g. 0.05 = +5%/day)."
            />
            <small>Fraction of Max charge per day (e.g. 0.05 = +5%/day).</small>
          </label>
          <label class="field">
            <span>Passive drain per day</span>
            <input
              id="passiveDrainPerDay"
              type="number"
              min="0"
              step="0.001"
              title="Removes charge over time. This is a fraction of Max charge per in-game day (e.g. 0.10 = -10%/day)."
            />
            <small>Fraction of Max charge per day (e.g. 0.10 = -10%/day).</small>
          </label>

          <div class="field field--wide">
            <h3>Optional regen sources</h3>
            <p>These add extra regen when their condition is true. Min values are 0..1 (percent).</p>
            <div class="row">
              <label class="check">
                <input id="regenFromMood" type="checkbox" />
                <span>Regen from mood</span>
              </label>
              <label class="field">
                <span>Mood min</span>
                <input id="moodMin" type="number" min="0" max="1" step="0.01" title="Only regen if mood is at/above this percent (0..1)." />
              </label>
              <label class="field">
                <span>Mood regen per day</span>
                <input
                  id="moodRegenPerDay"
                  type="number"
                  min="0"
                  step="0.001"
                  title="Extra regen while mood condition is met (fraction of Max charge per day)."
                />
              </label>
            </div>

            <div class="row">
              <label class="check">
                <input id="regenFromPain" type="checkbox" />
                <span>Regen from pain</span>
              </label>
              <label class="field">
                <span>Pain min</span>
                <input id="painMin" type="number" min="0" max="1" step="0.01" title="Only regen if pain is at/above this percent (0..1)." />
              </label>
              <label class="field">
                <span>Pain regen per day</span>
                <input
                  id="painRegenPerDay"
                  type="number"
                  min="0"
                  step="0.001"
                  title="Extra regen while pain condition is met (fraction of Max charge per day)."
                />
              </label>
            </div>

            <div class="row">
              <label class="check">
                <input id="regenFromSunlight" type="checkbox" />
                <span>Regen from sunlight</span>
              </label>
              <label class="field">
                <span>Min glow</span>
                <input id="sunlightMinGlow" type="number" min="0" max="1" step="0.01" title="Only regen if current light level (glow) is at/above this (0..1)." />
              </label>
              <label class="field">
                <span>Sunlight regen per day</span>
                <input
                  id="sunlightRegenPerDay"
                  type="number"
                  min="0"
                  step="0.001"
                  title="Extra regen while sunlight condition is met (fraction of Max charge per day)."
                />
              </label>
            </div>

            <div class="row">
              <label class="check">
                <input id="regenFromPsyfocus" type="checkbox" />
                <span>Regen from psyfocus</span>
              </label>
              <label class="field">
                <span>Psyfocus min</span>
                <input id="psyfocusMin" type="number" min="0" max="1" step="0.01" title="Only regen if psyfocus is at/above this percent (0..1)." />
              </label>
              <label class="field">
                <span>Psyfocus regen per day</span>
                <input
                  id="psyfocusRegenPerDay"
                  type="number"
                  min="0"
                  step="0.001"
                  title="Extra regen while psyfocus condition is met (fraction of Max charge per day)."
                />
              </label>
            </div>

            <div class="row">
              <label class="check">
                <input id="regenFromNearbyAllies" type="checkbox" />
                <span>Regen from nearby allies</span>
              </label>
              <label class="field">
                <span>Radius</span>
                <input id="alliesRadius" type="number" min="0" step="1" title="How far to search for allied pawns." />
              </label>
              <label class="field">
                <span>Max count</span>
                <input id="alliesMaxCount" type="number" min="0" step="1" title="Caps how many allies contribute regen (0 means none)." />
              </label>
              <label class="field">
                <span>Each per day</span>
                <input
                  id="alliesRegenPerDayEach"
                  type="number"
                  min="0"
                  step="0.001"
                  title="Extra regen per nearby ally (fraction of Max charge per day)."
                />
              </label>
            </div>
          </div>
        </div>
      </section>

      <section class="panel" data-panel="abilities">
        <h2>Abilities</h2>
        <p>Select which built-in Lantern ability bases to generate. Each ability needs an icon path (you provide the texture).</p>

        <!-- Autocomplete lists (populated by Import Defs) -->
        <datalist id="defs_ThingDef"></datalist>
        <datalist id="defs_ApparelDef"></datalist>
        <datalist id="defs_PawnKindDef"></datalist>
        <datalist id="defs_HediffDef"></datalist>
        <datalist id="defs_TraitDef"></datalist>
        <datalist id="defs_NeedDef"></datalist>
        <datalist id="defs_StatDef"></datalist>
        <datalist id="defs_SkillDef"></datalist>
        <datalist id="defs_ThoughtDef"></datalist>
        <datalist id="defs_MentalStateDef"></datalist>
        <datalist id="defs_DamageDef"></datalist>
        <datalist id="defs_RecordDef"></datalist>
        <datalist id="defs_MemeDef"></datalist>
        <datalist id="defs_PreceptDef"></datalist>
        <datalist id="defs_GeneDef"></datalist>
        <datalist id="defs_LetterDef"></datalist>

        <div class="abilities">
          <div class="abilities__pick">
            <label class="check"><input type="checkbox" data-ability="Blast" /> Blast</label>
            <label class="check"><input type="checkbox" data-ability="Heal" /> Heal</label>
            <label class="check"><input type="checkbox" data-ability="Stun" /> Stun/Bind</label>
            <label class="check"><input type="checkbox" data-ability="Barrier" /> Barrier (shield)</label>
            <label class="check"><input type="checkbox" data-ability="Construct" /> Construct spawn</label>
            <label class="check"><input type="checkbox" data-ability="Summon" /> Summon</label>
            <label class="check"><input type="checkbox" data-ability="Aura" /> Aura</label>
            <label class="check"><input type="checkbox" data-ability="Flight" /> Flight</label>
            <label class="check"><input type="checkbox" data-ability="Teleport" /> Teleport</label>
            <label class="check"><input type="checkbox" data-ability="Displace" /> Displace (push/pull)</label>
            <label class="check"><input type="checkbox" data-ability="Conditional" /> Conditional down/kill</label>
          </div>

          <div class="abilities__editor">
            <div id="abilityEditors" class="stack"></div>
          </div>
        </div>
      </section>

      <section class="panel" data-panel="selection">
        <h2>Selection (optional)</h2>
        <p>Generates a <code>RingSelectionDef</code> (auto-delivery) and optional scoring conditions.</p>
        <div class="grid">
          <label class="field">
            <span>Enable selection def</span>
            <select id="enableSelection">
              <option value="no">No</option>
              <option value="yes">Yes</option>
            </select>
            <small id="enableSelectionDesc" class="muted"></small>
          </label>
          <label class="field">
            <span>Selection defName</span>
            <input id="selectionDefName" type="text" placeholder="MyLantern_Selection" />
          </label>
          <label class="field">
            <span>Trigger</span>
            <select id="selectionTrigger">
              <option value="onJoin">On join player faction</option>
              <option value="onSpawn">On spawn on player home map</option>
              <option value="onMental">On any mental break</option>
            </select>
            <small id="selectionTriggerDesc" class="muted"></small>
          </label>
          <label class="field">
            <span>Exclude if pawn already has a ring</span>
            <select id="excludeIfHasAnyLanternRing">
              <option value="true">True</option>
              <option value="false">False</option>
            </select>
            <small id="excludeIfHasAnyLanternRingDesc" class="muted"></small>
          </label>

          <div class="field field--wide">
            <h3>Candidate filters</h3>
            <div class="row">
              <label class="check"><input id="sel_allowColonists" type="checkbox" /> <span>Colonists</span></label>
              <label class="check"><input id="sel_allowPrisoners" type="checkbox" /> <span>Prisoners</span></label>
              <label class="check"><input id="sel_allowSlaves" type="checkbox" /> <span>Slaves</span></label>
            </div>
            <div class="row">
              <label class="check"><input id="sel_allowGuests" type="checkbox" /> <span>Guests</span></label>
              <label class="check"><input id="sel_allowAnimals" type="checkbox" /> <span>Animals</span></label>
              <label class="check"><input id="sel_allowMechs" type="checkbox" /> <span>Mechs</span></label>
            </div>
            <div class="row">
              <label class="check"><input id="sel_allowHostiles" type="checkbox" /> <span>Hostiles</span></label>
              <label class="check"><input id="sel_allowDowned" type="checkbox" /> <span>Downed</span></label>
              <label class="check"><input id="sel_allowDead" type="checkbox" /> <span>Dead</span></label>
            </div>
            <div class="row">
              <label class="check"><input id="sel_requireViolenceCapable" type="checkbox" /> <span>Require violence capable</span></label>
            </div>
          </div>

          <div class="field field--wide">
            <h3>Conditions (scoring)</h3>
            <div class="grid">
              <label class="field">
                <span>Condition type</span>
                <select id="condType">
                  <option value="Trait">Trait</option>
                  <option value="Stat">Stat</option>
                  <option value="Skill">Skill</option>
                  <option value="Mood">Mood</option>
                  <option value="Need">Need</option>
                  <option value="Thought">Thought</option>
                  <option value="Record">Record</option>
                </select>
                <small id="condTypeDesc" class="muted"></small>
              </label>
              <label class="field">
                <span>Def (varies by type)</span>
                <input id="condDef" type="text" placeholder="TraitDef / StatDef / NeedDef / ..." />
                <small>After importing defs, this field will autocomplete.</small>
              </label>
              <label class="field">
                <span>Params (simple)</span>
                <input id="condParamA" type="text" placeholder="e.g. scoreBonus=10" />
                <small>Examples: <code>scoreBonus=10</code>, <code>minLevel=6</code>, <code>lowerIsBetter=true</code></small>
              </label>
              <div class="field">
                <span>Action</span>
                <button id="btnAddCondition" class="btn btn--primary">Add condition</button>
                <small>Advanced params can be edited later in XML.</small>
              </div>
            </div>
            <div id="conditionList" class="cardList"></div>
          </div>
        </div>
      </section>

      <section class="panel" data-panel="events">
        <h2>World Events (optional)</h2>
        <p>Creates a world-map discovery site (crash, ruin, stash) that contains your gear.</p>
        <div class="grid">
          <label class="field">
            <span>Enable discovery event</span>
            <select id="enableDiscoveryEvent">
              <option value="no">No</option>
              <option value="yes">Yes</option>
            </select>
          </label>
          <label class="field">
            <span>Event target</span>
            <select id="discoveryTargetType">
              <option value="WorldSite">World site (caravan)</option>
              <option value="ActiveMap">Active map (local crash)</option>
            </select>
          </label>
          <label class="field field--wide">
            <span>Target tags override (optional, comma-separated)</span>
            <input id="discoveryTargetTags" type="text" placeholder="Map, World" />
            <small class="muted">Leave blank to auto-set based on Event target.</small>
          </label>
          <label class="field">
            <span>Incident defName</span>
            <input id="discoveryIncidentDefName" type="text" placeholder="MyHeroGear_Discovery" />
          </label>
          <label class="field">
            <span>Incident category</span>
            <input id="discoveryIncidentCategory" type="text" placeholder="Misc" />
          </label>
          <label class="field">
            <span>Base chance</span>
            <input id="discoveryIncidentBaseChance" type="number" min="0" step="0.01" />
          </label>
          <label class="field">
            <span>Min refire days (optional)</span>
            <input id="discoveryMinRefireDays" type="number" min="0" step="0.1" />
          </label>
          <label class="field">
            <span>Points scaleable</span>
            <select id="discoveryPointsScaleable">
              <option value="default">Default (inherit)</option>
              <option value="true">True</option>
              <option value="false">False</option>
            </select>
          </label>
          <label class="field">
            <span>Send letter</span>
            <select id="discoverySendLetter">
              <option value="yes">Yes</option>
              <option value="no">No</option>
            </select>
          </label>
          <label class="field field--wide">
            <span>Letter label (optional)</span>
            <input id="discoveryLetterLabel" type="text" placeholder="Discovery site" />
          </label>
          <label class="field field--wide">
            <span>Letter label key (optional)</span>
            <input id="discoveryLetterLabelKey" type="text" placeholder="MyMod_Discovery_Label" />
            <small class="muted">Used when Letter label is blank.</small>
          </label>
          <label class="field field--wide">
            <span>Letter text (optional)</span>
            <textarea id="discoveryLetterText" rows="3" placeholder="Scouts detected a site that may contain the gear..."></textarea>
          </label>
          <label class="field field--wide">
            <span>Letter text key (optional)</span>
            <input id="discoveryLetterTextKey" type="text" placeholder="MyMod_Discovery_Text" />
            <small class="muted">Used when Letter text is blank.</small>
          </label>
          <label class="field">
            <span>Letter def (optional)</span>
            <input id="discoveryLetterDef" type="text" placeholder="NeutralEvent" list="defs_LetterDef" />
          </label>
        </div>

        <div class="field field--wide">
          <h3>Site details</h3>
          <div class="grid">
            <label class="field">
              <span>Site label (optional)</span>
              <input id="discoverySiteLabel" type="text" placeholder="mysterious site" />
            </label>
            <label class="field field--wide">
              <span>Site description (optional)</span>
              <textarea id="discoverySiteDescription" rows="2" placeholder="A remote site marked by unusual readings."></textarea>
            </label>
            <label class="field">
              <span>Timeout days (0 = never)</span>
              <input id="discoverySiteTimeoutDays" type="number" min="0" step="0.1" />
            </label>
            <label class="field">
              <span>Min distance (tiles)</span>
              <input id="discoveryMinDistanceTiles" type="number" min="0" step="1" />
            </label>
            <label class="field">
              <span>Max distance (tiles)</span>
              <input id="discoveryMaxDistanceTiles" type="number" min="0" step="1" />
            </label>
            <label class="field">
              <span>Map drop radius (cells)</span>
              <input id="discoveryMapDropRadius" type="number" min="0" step="1" />
            </label>
            <label class="field">
              <span>Drop near colony structures</span>
              <label class="check">
                <input id="discoveryMapDropPreferColony" type="checkbox" />
                <span>Yes</span>
              </label>
            </label>
          </div>
        </div>

        <div class="field field--wide">
          <h3>Gear placement</h3>
          <div class="grid">
            <label class="field">
              <span>Placement</span>
              <select id="discoveryGearPlacement">
                <option value="PawnWorn">Pawn worn</option>
                <option value="PawnInventory">Pawn inventory</option>
                <option value="Ground">On ground</option>
                <option value="DropPod">Drop pod</option>
              </select>
            </label>
            <label class="field">
              <span>Receiver</span>
              <select id="discoveryGearReceiver">
                <option value="PreferAlive">Prefer alive</option>
                <option value="PreferDead">Prefer dead</option>
                <option value="AliveOnly">Alive only</option>
                <option value="DeadOnly">Dead only</option>
                <option value="AnyPawn">Any pawn</option>
              </select>
            </label>
            <label class="field">
              <span>Gear count</span>
              <input id="discoveryGearCount" type="number" min="1" step="1" />
            </label>
          </div>
        </div>

        <div class="field field--wide">
          <h3>Pawns (optional)</h3>
          <div class="grid">
            <label class="field">
              <span>PawnKindDef</span>
              <input id="discoveryPawnKind" type="text" placeholder="AncientSoldier" list="defs_PawnKindDef" />
            </label>
            <label class="field">
              <span>FactionDef (optional)</span>
              <input id="discoveryPawnFaction" type="text" placeholder="Ancients" />
            </label>
            <label class="field">
              <span>Alive min</span>
              <input id="discoveryAliveMin" type="number" min="0" step="1" />
            </label>
            <label class="field">
              <span>Alive max</span>
              <input id="discoveryAliveMax" type="number" min="0" step="1" />
            </label>
            <label class="field">
              <span>Dead min</span>
              <input id="discoveryDeadMin" type="number" min="0" step="1" />
            </label>
            <label class="field">
              <span>Dead max</span>
              <input id="discoveryDeadMax" type="number" min="0" step="1" />
            </label>
            <label class="field">
              <span>Down alive pawns</span>
              <select id="discoveryAliveDowned">
                <option value="true">Yes</option>
                <option value="false">No</option>
              </select>
            </label>
            <label class="field">
              <span>Scatter radius</span>
              <input id="discoveryPawnScatterRadius" type="number" min="0" step="1" />
            </label>
            <label class="field">
              <span>Drop pods for pawns</span>
              <select id="discoverySpawnPawnsInDropPods">
                <option value="true">Yes</option>
                <option value="false">No</option>
              </select>
            </label>
            <label class="field">
              <span>Drop pod open delay (sec)</span>
              <input id="discoveryDropPodOpenDelaySeconds" type="number" min="0" step="0.1" />
            </label>
          </div>
        </div>

        <div class="field field--wide">
          <h3>Crash debris (optional)</h3>
          <div class="grid">
            <label class="field">
              <span>Spawn crash debris</span>
              <select id="discoverySpawnCrashDebris">
                <option value="true">Yes</option>
                <option value="false">No</option>
              </select>
            </label>
            <label class="field">
              <span>Ship chunk ThingDef</span>
              <input id="discoveryCrashChunkDef" type="text" placeholder="ShipChunk" list="defs_ThingDef" />
            </label>
            <label class="field">
              <span>Debris ThingDef</span>
              <input id="discoveryCrashDebrisDef" type="text" placeholder="ChunkSlagSteel" list="defs_ThingDef" />
            </label>
            <label class="field">
              <span>Debris count</span>
              <input id="discoveryCrashDebrisCount" type="number" min="0" step="1" />
            </label>
            <label class="field">
              <span>Debris radius</span>
              <input id="discoveryCrashDebrisRadius" type="number" min="0" step="0.5" />
            </label>
          </div>
        </div>

        <div class="field field--wide">
          <h3>Timed incident (optional)</h3>
          <p class="muted">Schedules the discovery incident to fire after a random delay.</p>
          <div class="grid">
            <label class="field">
              <span>Enable timed incident</span>
              <select id="enableTimedIncident">
                <option value="no">No</option>
                <option value="yes">Yes</option>
              </select>
            </label>
            <label class="field">
              <span>Min days</span>
              <input id="timedIncidentMinDays" type="number" min="0" step="0.1" />
            </label>
            <label class="field">
              <span>Max days</span>
              <input id="timedIncidentMaxDays" type="number" min="0" step="0.1" />
            </label>
            <label class="field">
              <span>Retry hours</span>
              <input id="timedIncidentRetryHours" type="number" min="0" step="0.1" />
            </label>
            <label class="field">
              <span>Fire once</span>
              <select id="timedIncidentFireOnce">
                <option value="yes">Yes</option>
                <option value="no">No</option>
              </select>
            </label>
            <label class="field">
              <span>Force fire (ignore normal chance)</span>
              <select id="timedIncidentForce">
                <option value="yes">Yes</option>
                <option value="no">No</option>
              </select>
            </label>
            <label class="field">
              <span>Target</span>
              <select id="timedIncidentTarget">
                <option value="PlayerHomeMap">Player home map</option>
                <option value="CurrentMap">Current map</option>
                <option value="AnyPlayerMap">Any player map</option>
                <option value="World">World</option>
              </select>
            </label>
          </div>
        </div>
      </section>

      <section class="panel" data-panel="export">
        <h2>Export</h2>
        <p>Preview what will be generated. The ZIP export does not include textures; use the checklist to add your own PNGs.</p>
        <div class="grid">
          <div class="field field--wide">
            <h3>Validation</h3>
            <pre id="validation" class="pre"></pre>
          </div>
          <div class="field field--wide">
            <h3>Dependencies (auto + extra)</h3>
            <pre id="dependencyChecklist" class="pre"></pre>
          </div>
          <div class="field field--wide">
            <h3>Textures you must add</h3>
            <pre id="textureChecklist" class="pre"></pre>
          </div>
          <div class="field field--wide">
            <h3>Preview: Generated XML</h3>
            <pre id="xmlPreview" class="pre"></pre>
          </div>
        </div>
      </section>
    </main>

    <footer class="footer">
      <span>Hero Gear Builder</span>
      <span class="muted">Exports a ZIP; you add textures yourself.</span>
    </footer>

    <script src="./vendor/jszip.min.js"></script>
    <script src="./assets/app.js"></script>
  </body>
</html>
